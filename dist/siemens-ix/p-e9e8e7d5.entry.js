import{r as t,c as s,h as i,H as e,g as r}from"./p-3b388d55.js";import{f as n,i as o,s as h,o as a,a as d,c}from"./p-b3f35666.js";function l(t){return t&&t.getDropdownItemElement!==undefined&&typeof t.getDropdownItemElement==="function"}class u{constructor(){this.dropdowns=new Map;this.submenuIds={};this.isWindowListenerActive=false}connected(t){if(!this.isWindowListenerActive){this.addOverlayListeners()}this.dropdowns.set(t.getId(),t);if(t.discoverAllSubmenus){this.discoverSubmenus()}}disconnected(t){this.dropdowns.delete(t.getId())}discoverSubmenus(){this.dropdowns.forEach((t=>{t.discoverSubmenu()}))}present(t){if(!t.isPresent()&&t.willPresent()){this.submenuIds[t.getId()]=t.getAssignedSubmenuIds();t.present()}}dismissChildren(t){const s=this.submenuIds[t]||[];for(const t of s){this.dismiss(this.dropdowns.get(t))}}dismiss(t){if(t.isPresent()&&t.willDismiss()){this.dismissChildren(t.getId());t.dismiss();delete this.submenuIds[t.getId()]}}dismissAll(t=[]){this.dropdowns.forEach((s=>{if(!t.includes(s.getId())&&(s.closeBehavior==="inside"||s.closeBehavior===false)){return}this.dismiss(s)}))}dismissOthers(t){let s=this.buildComposedPath(t,new Set);this.dropdowns.forEach((t=>{if(t.closeBehavior!=="inside"&&t.closeBehavior!==false&&!s.has(t.getId())){this.dismiss(t)}}))}pathIncludesTrigger(t){for(let s of t){if(s instanceof HTMLElement){if(s.hasAttribute("data-ix-dropdown-trigger")){return true}}}return false}pathIncludesDropdown(t){return!!t.find((t=>t.tagName==="IX-DROPDOWN"))}buildComposedPath(t,s){if(this.submenuIds[t]){s.add(t)}for(const i of Object.keys(this.submenuIds)){if(this.submenuIds[i].includes(t)){this.buildComposedPath(i,s).forEach((t=>s.add(t)))}}return s}addOverlayListeners(){this.isWindowListenerActive=true;window.addEventListener("click",(t=>{const s=this.pathIncludesTrigger(t.composedPath());const i=this.pathIncludesDropdown(t.composedPath());if(!s&&!i){this.dismissAll()}}));window.addEventListener("keydown",(t=>{if(t.key==="Escape"){this.dismissAll([...this.dropdowns.keys()])}}))}}const f=(t,s,i)=>{t.addEventListener(s,i);return()=>{t.removeEventListener(s,i)}};const b=new u;const m=":host{background-color:var(--theme-color-2);border-radius:var(--theme-default-border-radius);min-width:0px;z-index:var(--theme-z-index-dropdown);box-shadow:var(--theme-shadow-4);padding:0.25rem 0px}:host *,:host *::after,:host *::before{box-sizing:border-box}:host ::-webkit-scrollbar-button{display:none}:host ::-webkit-scrollbar{width:0.5rem;height:0.5rem}:host ::-webkit-scrollbar-track{border-radius:5px;background:var(--theme-scrollbar-track--background)}:host ::-webkit-scrollbar-track:hover{background:var(--theme-scrollbar-track--background--hover)}:host ::-webkit-scrollbar-thumb{border-radius:5px;background:var(--theme-scrollbar-thumb--background)}:host ::-webkit-scrollbar-thumb:hover{background:var(--theme-scrollbar-thumb--background--hover)}:host ::-webkit-scrollbar-corner{display:none}:host .dropdown-header{display:flex;align-items:center;height:2.5rem;color:var(--theme-menu-header--color);padding:0 1rem}:host(.overflow){max-height:50vh;overflow-y:auto}:host(:not(.show)){display:none}";const w=m;let p=0;const g=class{constructor(i){t(this,i);this.showChanged=s(this,"showChanged",7);this.autoUpdateCleanup=null;this.localUId=`dropdown-${p++}`;this.assignedSubmenu=[];this.suppressAutomaticPlacement=false;this.show=false;this.trigger=undefined;this.anchor=undefined;this.closeBehavior="both";this.placement="bottom-start";this.positioningStrategy="fixed";this.header=undefined;this.offset=undefined;this.overwriteDropdownStyle=undefined;this.discoverAllSubmenus=false}connectedCallback(){b.connected(this)}cacheSubmenuId(t){t.stopImmediatePropagation();t.preventDefault();const{detail:s}=t;if(this.assignedSubmenu.indexOf(s)===-1){this.assignedSubmenu.push(s)}}disconnectedCallback(){var t;(t=this.disposeListener)===null||t===void 0?void 0:t.call(this);b.disconnected(this);if(this.autoUpdateCleanup){this.autoUpdateCleanup()}}getAssignedSubmenuIds(){return this.assignedSubmenu}isPresent(){return this.show}present(){this.show=true}dismiss(){this.show=false}getId(){return this.localUId}willDismiss(){const{defaultPrevented:t}=this.showChanged.emit(false);return!t}willPresent(){const{defaultPrevented:t}=this.showChanged.emit(true);return!t}get dropdownItems(){return Array.from(this.hostElement.querySelectorAll("ix-dropdown-item"))}get slotElement(){return this.hostElement.shadowRoot.querySelector("slot")}addEventListenersFor(){var t,s;(t=this.disposeListener)===null||t===void 0?void 0:t.call(this);const i=()=>{if(!this.isPresent()){b.present(this)}else{b.dismiss(this)}b.dismissOthers(this.getId())};this.disposeListener=f(this.triggerElement,"click",(t=>{if(!t.defaultPrevented){i()}}));(s=this.triggerElement)===null||s===void 0?void 0:s.setAttribute("data-ix-dropdown-trigger",this.localUId)}async discoverSubmenu(){var t;(t=this.triggerElement)===null||t===void 0?void 0:t.dispatchEvent(new CustomEvent("ix-assign-sub-menu",{bubbles:true,composed:false,cancelable:true,detail:this.localUId}))}async registerListener(t){this.triggerElement=await this.resolveElement(t);if(this.triggerElement){this.addEventListenersFor();this.discoverSubmenu()}}async resolveElement(t){const s=await this.findElement(t);return this.checkForSubmenuAnchor(s)}async checkForSubmenuAnchor(t){if(!t){return null}if(l(t)){const s=await t.getDropdownItemElement();s.isSubMenu=true;this.hostElement.style.zIndex=`var(--theme-z-index-dropdown)`}if(t.tagName==="IX-DROPDOWN-ITEM"){t.isSubMenu=true;this.hostElement.style.zIndex=`var(--theme-z-index-dropdown)`}return t}findElement(t){if(t instanceof Promise){return t}if(typeof t==="object"){return Promise.resolve(t)}const s=`#${t}`;return new Promise((t=>{if(document.querySelector(s)){return t(document.querySelector(s))}const i=new MutationObserver((()=>{if(document.querySelector(s)){t(document.querySelector(s));i.disconnect()}}));i.observe(document.body,{childList:true,subtree:true})}))}async changedShow(t){if(t){this.anchorElement=await(this.anchor?this.resolveElement(this.anchor):this.resolveElement(this.trigger));if(this.anchorElement){this.applyDropdownPosition()}}}changedTrigger(t){this.registerListener(t)}isAnchorSubmenu(){var t;if(!l(this.anchorElement)){return!!((t=this.anchorElement)===null||t===void 0?void 0:t.closest("ix-dropdown-item"))}return true}async applyDropdownPosition(){if(!this.anchorElement){return}if(!this.dropdownRef){return}const t=this.isAnchorSubmenu();let s={strategy:this.positioningStrategy,middleware:[]};if(!this.suppressAutomaticPlacement){s.middleware.push(n({fallbackStrategy:"initialPlacement"}))}s.placement=t?"right-start":this.placement;s.middleware=[...s.middleware,o(),h()];if(this.offset){s.middleware.push(a(this.offset))}if(this.autoUpdateCleanup){this.autoUpdateCleanup();this.autoUpdateCleanup=null}this.autoUpdateCleanup=d(this.anchorElement,this.dropdownRef,(async()=>{const t=await c(this.anchorElement,this.dropdownRef,s);Object.assign(this.dropdownRef.style,{top:"0",left:"0",transform:`translate(${Math.round(t.x)}px,${Math.round(t.y)}px)`});if(this.overwriteDropdownStyle){const t=await this.overwriteDropdownStyle({dropdownRef:this.dropdownRef,triggerRef:this.triggerElement});Object.assign(this.dropdownRef.style,t)}}),{ancestorResize:true,ancestorScroll:true,elementResize:true})}async componentDidLoad(){this.changedTrigger(this.trigger)}async componentDidRender(){await this.applyDropdownPosition();this.anchorElement=await(this.anchor?this.resolveElement(this.anchor):this.resolveElement(this.trigger))}isTriggerElement(t){const s=!!t.hasAttribute("data-ix-dropdown-trigger");return s}onDropdownClick(t){if(b.pathIncludesTrigger(t.composedPath())){t.preventDefault();if(this.isTriggerElement(t.target)){return}}if(this.closeBehavior==="inside"||this.closeBehavior==="both"){b.dismissAll([this.getId()])}b.dismissOthers(this.getId())}async updatePosition(){this.applyDropdownPosition()}render(){return i(e,{key:"704bc3d7987061a7b9835263d45ee11f753ba71b","data-ix-dropdown":this.localUId,ref:t=>this.dropdownRef=t,class:{"dropdown-menu":true,show:this.show,overflow:true},style:{margin:"0",minWidth:"0px",position:this.positioningStrategy},role:"list",onClick:t=>this.onDropdownClick(t)},i("div",{key:"5e0c4a15d72372573f992b86774d52bfa64c72c8",style:{display:"contents"}},this.header&&i("div",{class:"dropdown-header"},this.header),i("slot",{key:"f182bef9568ab69d49a5fb2d2fbccfdd05041c80"})))}get hostElement(){return r(this)}static get watchers(){return{show:["changedShow"],trigger:["changedTrigger"]}}};g.style=w;export{g as ix_dropdown};
//# sourceMappingURL=p-e9e8e7d5.entry.js.map