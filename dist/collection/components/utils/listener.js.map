{"version":3,"file":"listener.js","sourceRoot":"","sources":["../../../../src/components/utils/listener.ts"],"names":[],"mappings":"AAAA;;;;;;;GAOG;AAEH,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAO3C,MAAM,cAAc,GAAoB;IACtC,MAAM,EAAE,QAAQ;IAChB,cAAc,EAAE,IAAI;CACrB,CAAC;AAEF,MAAM,UAAU,cAAc,CAAC,KAAa,EAAE,UAA2B,EAAE;IACzE,MAAM,IAAI,mCACL,cAAc,GACd,OAAO,CACX,CAAC;IAEF,IAAI,QAAa,CAAC;IAClB,MAAM,OAAO,GAAG,CAAC,KAAY,EAAE,EAAE;QAC/B,QAAQ,CAAC,KAAK,CAAC,CAAC;IAClB,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG;QACnB,EAAE,EAAE,CAAC,eAAoB,EAAE,EAAE;YAC3B,QAAQ,GAAG,eAAe,CAAC;QAC7B,CAAC;QAED,SAAS,EAAE,IAAI,CAAC,cAAc;QAE9B,MAAM,EAAE,CAAC,KAAc,EAAE,EAAE;YACzB,YAAY,CAAC,SAAS,GAAG,KAAK,CAAC;YAE/B,IAAI,KAAK,EAAE,CAAC;gBACV,gBAAgB,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YACnC,CAAC;iBAAM,CAAC;gBACN,mBAAmB,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YACtC,CAAC;QACH,CAAC;QAED,OAAO,EAAE,GAAG,EAAE;YACZ,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC;KACF,CAAC;IAEF,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IACzC,OAAO,YAAY,CAAC;AACtB,CAAC;AAED,MAAM,UAAU,UAAU,CAAI,KAAa,EAAE,KAA4B;IACvE,OAAO,CAAC,KAAU,EAAE,UAAkB,EAAE,EAAE;QACxC,MAAM,EAAE,iBAAiB,EAAE,mBAAmB,EAAE,oBAAoB,EAAE,GACpE,KAAK,CAAC;QAER,IAAI,KAAK,EAAE,CAAC;YACV,KAAK,CAAC,mBAAmB,GAAG;;gBAC1B,MAAM,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;gBAC9B,MAAA,IAAI,CAAC,SAAS,UAAU,EAAE,CAAC,0CAAE,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;gBACjD,OAAO,mBAAmB,IAAI,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC/D,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,iBAAiB,GAAG;YACxB,MAAM,QAAQ,GAAG,cAAc,CAAC,KAAK,CAAC,CAAC;YACvC,MAAM,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;YAC9B,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;YAEhC,IAAI,CAAC,SAAS,UAAU,EAAE,CAAC,GAAG,QAAQ,CAAC;YAEvC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAC/B,OAAO,iBAAiB,IAAI,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,CAAC,CAAC;QAEF,KAAK,CAAC,oBAAoB,GAAG;;YAC3B,MAAM,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;YAE9B,IAAI,IAAI,IAAI,IAAI,CAAC,SAAS,UAAU,EAAE,CAAC,EAAE,CAAC;gBACxC,MAAA,IAAI,CAAC,SAAS,UAAU,EAAE,CAAC,0CAAE,OAAO,EAAE,CAAC;gBACvC,IAAI,CAAC,SAAS,UAAU,EAAE,CAAC,GAAG,IAAI,CAAC;YACrC,CAAC;YAED,OAAO,oBAAoB,IAAI,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACjE,CAAC,CAAC;IACJ,CAAC,CAAC;AACJ,CAAC","sourcesContent":["/*\n * SPDX-FileCopyrightText: 2023 Siemens AG\n *\n * SPDX-License-Identifier: MIT\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { getElement } from '@stencil/core';\n\nexport type ListenerOptions = {\n  target?: 'window';\n  defaultEnabled?: boolean;\n};\n\nconst defaultOptions: ListenerOptions = {\n  target: 'window',\n  defaultEnabled: true,\n};\n\nexport function createListener(event: string, options: ListenerOptions = {}) {\n  const opts = {\n    ...defaultOptions,\n    ...options,\n  };\n\n  let callback: any;\n  const onEvent = (event: Event) => {\n    callback(event);\n  };\n\n  const resultObject = {\n    on: (onEventCallback: any) => {\n      callback = onEventCallback;\n    },\n\n    isEnabled: opts.defaultEnabled,\n\n    enable: (state: boolean) => {\n      resultObject.isEnabled = state;\n\n      if (state) {\n        addEventListener(event, onEvent);\n      } else {\n        removeEventListener(event, onEvent);\n      }\n    },\n\n    destroy: () => {\n      resultObject.enable(false);\n    },\n  };\n\n  resultObject.enable(opts.defaultEnabled);\n  return resultObject;\n}\n\nexport function OnListener<T>(event: string, fnExp?: (self: T) => boolean) {\n  return (proto: any, methodName: string) => {\n    const { componentWillLoad, componentWillRender, disconnectedCallback } =\n      proto;\n\n    if (fnExp) {\n      proto.componentWillRender = function () {\n        const host = getElement(this);\n        host[`__ix__${methodName}`]?.enable(fnExp(this));\n        return componentWillRender && componentWillRender.call(this);\n      };\n    }\n\n    proto.componentWillLoad = function () {\n      const listener = createListener(event);\n      const host = getElement(this);\n      const method = this[methodName];\n\n      host[`__ix__${methodName}`] = listener;\n\n      listener.on(method.bind(this));\n      return componentWillLoad && componentWillLoad.call(this);\n    };\n\n    proto.disconnectedCallback = function () {\n      const host = getElement(this);\n\n      if (host && host[`__ix__${methodName}`]) {\n        host[`__ix__${methodName}`]?.destroy();\n        host[`__ix__${methodName}`] = null;\n      }\n\n      return disconnectedCallback && disconnectedCallback.call(this);\n    };\n  };\n}\n"]}